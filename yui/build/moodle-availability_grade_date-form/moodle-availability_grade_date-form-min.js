YUI.add("moodle-availability_grade_date-form",function(e,t){M.availability_grade_date=M.availability_grade_date||{},M.availability_grade_date.form=e.Object(M.core_availability.plugin),M.availability_grade_date.form.grades=null,M.availability_grade_date.form.initInner=function(e,t,n){this.grades=e,this.nodesSoFar=0,this.html=t,this.defaultTime=n},M.availability_grade_date.form.getNode=function(t){this.nodesSoFar++;var n="<label>"+M.util.get_string("title","availability_grade_date")+' <span class="availability-group">'+'<select name="id"><option value="0">'+M.util.get_string("choosedots","moodle")+"</option>";for(var r=0;r<this.grades.length;r++){var i=this.grades[r];n+='<option value="'+i.id+'">'+i.name+"</option>"}n+='</select></span></label> <span class="availability-group"><label><input type="checkbox" name="min"/>'+M.util.get_string("option_min","availability_grade_date")+'</label> <label><span class="accesshide">'+M.util.get_string("label_min","availability_grade_date")+'</span><input type="text" name="minval" title="'+M.util.get_string("label_min","availability_grade_date")+'"/></label>%</span>'+'<span class="availability-group">'+'<label><input type="checkbox" name="max"/>'+M.util.get_string("option_max","availability_grade_date")+'</label> <label><span class="accesshide">'+M.util.get_string("label_max","availability_grade_date")+'</span><input type="text" name="maxval" title="'+M.util.get_string("label_max","availability_grade_date")+'"/></label>%</span>',n+=M.util.get_string("direction_before","availability_grade_date")+' <span class="availability-group">'+'<label><span class="accesshide">'+M.util.get_string("direction_label","availability_grade_date")+" </span>"+'<select name="direction">'+'<option value="&gt;=">'+M.util.get_string("direction_from","availability_grade_date")+"</option>"+'<option value="&lt;">'+M.util.get_string("direction_until","availability_grade_date")+"</option>"+"</select></label></span> "+this.html;var s=e.Node.create("<span>"+n+"</span>");t.id!==undefined&&s.one("select[name=id] > option[value="+t.id+"]")&&s.one("select[name=id]").set("value",""+t.id),t.min!==undefined&&(s.one("input[name=min]").set("checked",!0),s.one("input[name=minval]").set("value",t.min)),t.max!==undefined&&(s.one("input[name=max]").set("checked",!0),s.one("input[name=maxval]").set("value",t.max));if(t.t!==undefined){s.setData("time",t.t),s.all("select:not([name=direction])").each(function(e){e.set("disabled",!0)});var o=M.cfg.wwwroot+"/availability/condition/grade_date/ajax.php?action=fromtime"+"&time="+t.t;e.io(o,{on:{success:function(t,n){var r=e.JSON.parse(n.responseText);for(var i in r){var o=s.one("select[name=x\\["+i+"\\]]");o.set("value",""+r[i]),o.set("disabled",!1)}},failure:function(){window.alert(M.util.get_string("ajaxerror","availability_grade_date"))}}})}else s.setData("time",this.defaultTime);t.d!==undefined&&s.one("select[name=direction]").set("value",t.d);var u=function(e,t){var n=e.ancestor("label").next("label").one("input"),r=e.get("checked");return n.set("disabled",!r),t&&r&&n.focus(),r};s.all("input[type=checkbox]").each(u);if(!M.availability_grade_date.form.addedEvents){M.availability_grade_date.form.addedEvents=!0;var a=e.one("#fitem_id_availabilityconditionsjson");a.delegate("change",function(){M.core_availability.form.update()},".availability_grade_date select[name=id]"),a.delegate("click",function(){u(this,!0),M.core_availability.form.update()},".availability_grade_date input[type=checkbox]"),a.delegate("valuechange",function(){M.core_availability.form.update()},".availability_grade_date input[type=text]"),a.delegate("change",function(){M.core_availability.form.update()},".availability_grade_date select[name=direction]"),a.delegate("change",function(){M.availability_grade_date.form.updateTime(this.ancestor("span.availability_grade_date"))},".availability_grade_date select:not([name=direction])")}if(s.one("a[href=#]")){M.form.dateselector.init_single_date_selector(s);var f=s.one("select[name=x\\[year\\]]"),l=f.set;f.set=function(e,t){l.call(f,e,t),e==="selectedIndex"&&setTimeout(function(){M.availability_grade_date.form.updateTime(s)},0)}}return s},M.availability_grade_date.form.updateTime=function(t){var n=M.cfg.wwwroot+"/availability/condition/date/ajax.php?action=totime"+"&year="+t.one("select[name=x\\[year\\]]").get("value")+"&month="+t.one("select[name=x\\[month\\]]").get("value")+"&day="+t.one("select[name=x\\[day\\]]").get("value")+"&hour="+t.one("select[name=x\\[hour\\]]").get("value")+"&minute="+t.one("select[name=x\\[minute\\]]").get("value");e.io(n,{on:{success:function(e,n){t.setData("time",n.responseText),M.core_availability.form.update()},failure:function(){window.alert(M.util.get_string("ajaxerror","availability_grade_date"))}}})},M.availability_grade_date.form.fillValue=function(e,t){e.id=parseInt(t.one("select[name=id]").get("value"),10),t.one("input[name=min]").get("checked")&&(e.min=this.getValue("minval",t)),t.one("input[name=max]").get("checked")&&(e.max=this.getValue("maxval",t)),e.d=t.one("select[name=direction]").get("value"),e.t=parseInt(t.getData("time"),10)},M.availability_grade_date.form.getValue=function(e,t){var n=t.one("input[name="+e+"]").get("value");if(!/^[0-9]+([.,][0-9]+)?$/.test(n))return n;var r=parseFloat(n.replace(",","."));return r<0||r>100?n:r},M.availability_grade_date.form.fillErrors=function(e,t){var n={};this.fillValue(n,t),n.id===0&&e.push("availability_grade_date:error_selectgradeid"),n.min!==undefined&&typeof n.min=="string"||n.max!==undefined&&typeof n.max=="string"?e.push("availability_grade_date:error_invalidnumber"):n.min!==undefined&&n.max!==undefined&&n.min>=n.max&&e.push("availability_grade_date:error_backwardrange")}},"@VERSION@",{requires:["base","node","event","io","moodle-core_availability-form"]});
